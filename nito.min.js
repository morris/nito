/*! Nito v1.0.0 - https://github.com/morris/nito */
!function(t,e){"function"==typeof define&&define.amd?define([],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:e(t.$)}(this,function(t){function e(t){return t.replace(/\]/g,"").split(/\[/g).map(function(t){return t.match(/^\d+$/)?parseInt(t,10):t})}function n(t){return null===t||void 0===t||t===!1?"":t===!0?"on":o(t)?t.map(n):t+""}t.nitoId=t.nitoId||0;var i=Object.assign||t.extend,o=Array.isArray||t.isArray,r=t.each;return t.nito=function(e){if(!e)throw new Error("Invalid settings");var n=function(e,n,i){t.Comp.call(this,e,n,i)};n.prototype=Object.create(t.Comp.prototype),i(n.prototype,e,{constructor:n,base:null,identify:null,id:null});var r=e.base;return i(n,t.Comp,{base:t(o(r)?r.join("\n"):r)[0],identify:e.identify,id:e.id||++t.nitoId}),n},t.Comp=function(e,n,i){this.el=e,this.$el=t(e),e&&this.parseRefs(e),this._sort=0,this._index=0,this.mount(i),this.set(n)},t.Comp.create=function(e,n){if(!this.base)throw new Error("Cannot create component without base");return t(this.base.cloneNode(!0)).mount(this,e,n)},i(t.Comp.prototype,{mount:function(){},update:function(){},unmount:function(){},set:function(t){return t&&(this.data=t),this.update(),this},on:function(){var t=this,e=[].map.call(arguments,function(e){return"function"==typeof e?e.bind(t):e});return t.$el.on.apply(t.$el,e),t},parseRefs:function(e){var n=e.getAttribute&&e.getAttribute("data-ref");n&&(this["$"+n]=t(e).add(this["$"+n]));for(var i=0,o=e.childNodes.length;i<o;++i)this.parseRefs(e.childNodes[i])}}),i(t.fn,{mount:function(e,n,i){if("function"!=typeof e||!e.id)throw new Error("Invalid component class");var o=e.id;return this.each(function(){var r=this,a=r.nitoComps=r.nitoComps||{};if(!a[o]){try{n||(n=JSON.parse(t(r).attr("data-nito-"+o)||null))}catch(t){"object"==typeof console&&console.warn(t)}a[o]=new e(r,n,i)}})},update:function(t,e){return this.eachComp(t,function(){this.set(e)})},unmount:function(t){return this.eachComp(t,function(){this.unmount(),delete this.el.nitoComps[this.constructor.id]})},nest:function(e,n,i){if("function"!=typeof e||!e.create||!e.id)throw new Error("Invalid component class");if(n&&!n.map)throw new Error("Invalid items");var o=e.identify;return this.each(function(){var r=this,a=r.children,s=r.nitoMap=r.nitoMap||{},c=0,u=(n||[]).map(function(t){var n=o?o(t):c+1;if(!n)throw new Error("Invalid key in nest");var r=s[n];return r?(r._sort=Math.abs(c-r._index),r.set(t)):(r=e.create(t,i)[0].nitoComps[e.id],s[n]=r,r._sort=-c),r._index=c++,r.el.nitoKeep=!0,r.el.nitoKey=n,r});for(c=0;c<a.length;){var h=a[c];h.nitoKeep?++c:(t(h).unmount(),r.removeChild(h),h.nitoKey&&delete s[h.nitoKey])}u.sort(function(t,e){return e._sort-t._sort||e._index-t._index}).forEach(function(t){var e=t.el,n=a[t._index];n?e!==n&&r.insertBefore(e,n):r.appendChild(e),e.nitoKeep=!1})})},nestOne:function(t,e,n){return this.nest(t,e?[e]:[],n)},classes:function(e){return this.each(function(){var n=this,i=t(n);r(e,function(t,e){i.toggleClass(t,!!e)})})},fhtml:function(t){return this.each(function(){null===t&&(t=""),this.nitoHtml!==t&&(this.innerHTML=this.nitoHtml=t)})},ftext:function(t){return this.each(function(){this.nitoText!==t&&(this.textContent=this.nitoText=t)})},serializeData:function(){var t={};return this.serializeArray().forEach(function(n){for(var i=t,o=e(n.name),r=o[0],a=0,s=o.length-1;a<s;++a){var c=o[a];r=o[a+1];var u=""===r||"number"==typeof r?[]:{};i=i[c]=i[c]||u}""===r?i.push(n.value):i[r]=n.value}),t},fill:function(n,i){return this.each(function(){var o=n;e(this.name||"").forEach(function(t){o&&""!==t&&(o=o[t])}),o===n&&(o=""),t(this).fval(o,i)})},fillDef:function(t){return this.fill(t,!0)},fval:function(e,i){var r="value",a="selected",s="checked";return i&&(r="defaultValue",a="defaultSelected",s="defaultChecked"),e=n(e),this.each(function(){var n=this,c=n.tagName;switch("INPUT"===c?n.type:c){case"SELECT":var u=n.multiple&&o(e);t(n).children().each(function(){var t=this.getAttribute("value")||this.textContent;this[a]=u?e.indexOf(t)>=0:e===t});break;case"TEXTAREA":n[r]!==e&&(n[r]=e),i&&t(n).ftext(e);break;case"radio":case"checkbox":var h=n.getAttribute("value")||"on";n[s]=o(e)?e.indexOf(h)>=0:e===h;break;case"OPTION":case"button":case"file":case"image":case"reset":case"submit":break;default:n[r]!==e&&(n[r]=e)}})},fdef:function(t){return this.fval(t,!0)},reset:function(){return this.each(function(){switch(this.tagName){case"FORM":this.reset();break;case"INPUT":"checkbox"===this.type||"radio"===this.type?this.checked=this.defaultChecked:this.value=this.defaultValue;break;case"TEXTAREA":this.value=this.defaultValue;break;case"OPTION":this.selected=this.defaultSelected;break;case"SELECT":t(this).children().reset()}})},deliver:function(){return this.eachComp(function(){var t=this.constructor.id;"string"==typeof t&&this.$el.attr("data-nito-"+t,JSON.stringify(this.data))})},outerHtml:function(){return t("<div></div>").append(this).html()},eachComp:function(t,e){if(t&&e){var n=t.id;return this.each(function(){var t=this.nitoComps&&this.nitoComps[n];t&&e.call(t)})}return e=e||t,this.each(function(){r(this.nitoComps||{},e)})}}),t});